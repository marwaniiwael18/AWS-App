# ========================================
# ğŸš€ AWS Amplify Build Configuration
# SkillSwap Frontend Deployment
# ========================================

version: 1

# ========================================
# ğŸ—ï¸ Build Environment
# ========================================
backend:
  phases:
    build:
      commands:
        - echo "No backend build required for static site"

frontend:
  phases:
    # ========================================
    # ğŸ“¦ Pre-Build Phase
    # ========================================
    preBuild:
      commands:
        - echo "ğŸ“¦ Installing frontend dependencies..."
        - npm ci
        - echo "ğŸ” Node.js version:"
        - node --version
        - echo "ğŸ“‹ NPM version:"
        - npm --version
        - echo "ğŸŒ Environment variables loaded"
        
    # ========================================
    # ğŸ—ï¸ Build Phase
    # ========================================
    build:
      commands:
        - echo "ğŸ—ï¸ Building React application..."
        - echo "Environment: $NODE_ENV"
        - echo "API URL: $VITE_API_URL"
        - npm run build
        - echo "âœ… Build completed successfully"
        
    # ========================================
    # ğŸ“¤ Post-Build Phase
    # ========================================
    postBuild:
      commands:
        - echo "ğŸ“¤ Post-build optimizations..."
        - echo "ğŸ“Š Build statistics:"
        - du -sh dist/*
        - echo "ğŸ“ Generated files:"
        - ls -la dist/
        
  # ========================================
  # ğŸ“ Build Artifacts
  # ========================================
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
      
  # ========================================
  # ğŸ’¾ Build Cache
  # ========================================
  cache:
    paths:
      - node_modules/**/*
      - .vite/**/*

# ========================================
# ğŸŒ App Configuration
# ========================================
customHeaders:
  - pattern: '**/*'
    headers:
      - key: 'Strict-Transport-Security'
        value: 'max-age=31536000; includeSubDomains'
      - key: 'X-Content-Type-Options'
        value: 'nosniff'
      - key: 'X-Frame-Options'
        value: 'DENY'
      - key: 'X-XSS-Protection'
        value: '1; mode=block'
        
  - pattern: '/static/**'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
        
  - pattern: '/api/**'
    headers:
      - key: 'Cache-Control'
        value: 'no-cache, no-store, must-revalidate'

# ========================================
# ğŸ”„ Redirects & Rewrites
# ========================================
redirects:
  - source: '/<*>'
    target: '/index.html'
    status: '404-200'
    condition: null 